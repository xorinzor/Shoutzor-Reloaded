Ember.LOG_BINDINGS=!1;Shoutzor=Ember.Application.createWithMixins(Bootstrap.Register);Shoutzor.ApplicationAdapter=DS.RESTAdapter.extend({host:CONFIG.host,namespace:CONFIG.namespace,buildURL:function(a,b){return this._super(a,b)+"/"}});Shoutzor.store=DS.Store.create({adapter:Shoutzor.ApplicationAdapter.create()});var attr=DS.attr;
Shoutzor.User=DS.Model.extend({name:attr("string"),firstname:attr("string"),email:attr("string"),joined:attr("date"),last_active:attr("date"),fullname:function(){return this.get("firstname")+" "+this.get("name")}.property("name","firstname")});attr=DS.attr;Shoutzor.Artist=DS.Model.extend({name:attr("string"),profileImage:attr("string")});var attr=DS.attr,belongsTo=DS.belongsTo;Shoutzor.Album=DS.Model.extend({artist:belongsTo("artist"),title:attr("string"),coverImage:attr("string")});
var attr=DS.attr,hasMany=DS.hasMany;
Shoutzor.Track=DS.Model.extend({title:attr("string"),length:attr("number"),artist:hasMany("artist"),album:hasMany("album"),convertedLength:function(){var a=parseInt(this.get("length"),10),b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),a=a-3600*b-60*c;10>b&&0<b&&(b="0"+b);10>c&&0<c&&(c="0"+c);10>a&&(a="0"+a);return(0!=b?b+":":"")+(0!=c?c+":":"")+a}.property("length"),artistNames:function(){var a="";this.get("artist").forEach(function(b){""!=a&&(a+=", ");a+=b.get("name")});return a}.property("artist")});
attr=DS.attr;hasMany=DS.hasMany;Shoutzor.Search=DS.Model.extend({tracks:hasMany("track"),artists:hasMany("artist"),albums:hasMany("album")});attr=DS.attr;belongsTo=DS.belongsTo;Shoutzor.Queue=DS.Model.extend({track:belongsTo("track"),user:belongsTo("user"),time_requested:attr("date"),print_time:function(){var a=new Date(this.get("time_requested")),b=(10>a.getHours()?"0":"")+a.getHours(),c=(10>a.getMinutes()?"0":"")+a.getMinutes(),a=(10>a.getSeconds()?"0":"")+a.getSeconds();return b+":"+c+":"+a}.property("time_requested")});
attr=DS.attr;belongsTo=DS.belongsTo;Shoutzor.History=DS.Model.extend({track:belongsTo("track"),user:belongsTo("user"),time_played:attr("date"),print_time:function(){var a=new Date(this.get("time_played")),b=(10>a.getHours()?"0":"")+a.getHours(),c=(10>a.getMinutes()?"0":"")+a.getMinutes(),a=(10>a.getSeconds()?"0":"")+a.getSeconds();return b+":"+c+":"+a}.property("time_played")});
Shoutzor.Router.map(function(){this.route("home",{path:"/"});this.route("search",{path:"/search"});this.route("queue",{path:"/queue"});this.route("chat",{path:"/chat"});this.route("upload",{path:"/upload"});this.route("profile",{path:"/profile"});this.route("settings",{path:"/settings"});this.route("track",{path:"/track/:id"});this.route("artist",{path:"/artist/:id"});this.route("album",{path:"/album/:id"})});
Shoutzor.ApplicationRoute=Ember.Route.extend({setupController:function(a){var b=this.get("store");a.set("history",b.all("history"));a.set("queue",b.all("queue"));a.set("artist",b.all("artist"));a.set("album",b.all("album"));a.set("track",b.all("track"));a.set("nextSong",b.find("queue",1));a.set("currentSong",b.find("history",1));a.set("previousSong",b.find("history",2))},renderTemplate:function(){this.render("application");this.render("rightSidebarOutput",{outlet:"rightSidebarOutput",into:"application"})},
model:function(){var a=this.get("store");a.find("history").then(function(a){a.content.sort();$("#updateContainer").statusUpdate({profileImage:"/static/themes/dashboard/images/album-cover-placeholder.jpg",nowplaying:a.content[0]})});a.find("queue").then(function(a){a.content.sort();a.content.forEach(function(a){Ember.run.once(this,function(){$("#updateContainer").statusUpdate({request:a})})},this)});setInterval(function(){a.find("queue").then(function(a){a.content.sort();a.content.forEach(function(a){Ember.run.once(this,
function(){$("#updateContainer").statusUpdate({request:a})})},this)});a.find("history").then(function(a){a.content.sort();$("#updateContainer").statusUpdate({profileImage:"/static/themes/dashboard/images/album-cover-placeholder.jpg",nowplaying:a.content[0]})})},5E3)}});Shoutzor.HomeRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","")},renderTemplate:function(){this.render("HomePageContent",{outlet:"pageContent",into:"application"})}});
Shoutzor.ArtistRoute=Ember.Route.extend({setupController:function(a,b){var c=b.get("id"),d=this.get("store");a.set("artist",d.find("artist",c));d.find("album",{artist:c}).then(function(b){a.set("album",b)})},renderTemplate:function(){this.render("ArtistPageContent",{outlet:"pageContent",into:"application"})},model:function(a){return this.store.find("artist",a.id)}});
Shoutzor.AlbumRoute=Ember.Route.extend({setupController:function(a,b){b.get("id");b.get("artist");this.get("store");a.set("album",b);a.set("artist",b.get("artist"))},renderTemplate:function(){this.render("AlbumPageContent",{outlet:"pageContent",into:"application"})},model:function(a){return this.store.find("album",a.id)}});
Shoutzor.ProfileRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","Profile")},renderTemplate:function(){this.render("ProfilePageContent",{outlet:"pageContent",into:"application"})}});Shoutzor.QueueRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","Queue");var c=this.get("store");a.set("model",c.all("queue"))},renderTemplate:function(){this.render("QueuePageContent",{outlet:"pageContent",into:"application"})}});
Shoutzor.SearchRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","Search");a.set("model",b);a.set("search","");a.set("query",!1);a.set("searching",!1)},renderTemplate:function(){this.render("SearchPageContent",{outlet:"pageContent",into:"application"})},model:function(){return this.store.all("search")}});
Shoutzor.SettingsRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","System settings")},renderTemplate:function(){this.render("SettingsPageContent",{outlet:"pageContent",into:"application"})}});
Shoutzor.TrackRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","Track");var c=this.get("store");a.set("track",c.find("track",b.get("id")))},renderTemplate:function(){this.render("TrackContent",{outlet:"pageContent",into:"application"})},model:function(a){return this.store.find("track",a.id)}});
Shoutzor.UploadRoute=Ember.Route.extend({setupController:function(a,b){a.set("pageTitle","Upload Tracks")},renderTemplate:function(){this.render("UploadPageContent",{outlet:"pageContent",into:"application"})},actions:{willTransition:function(a){0<parseInt($("#fileupload table .files tr.template-upload .error:empty").length)&&(alert("There are still files beeing uploaded, you will have to wait until all uploads are finished"),a.abort())}}});Shoutzor.AlbumController=Ember.Controller.extend({needs:["requesttrack"]});
Shoutzor.ApplicationController = Ember.Controller.extend({ needs:['playersettings'] });
Shoutzor.ArtistController=Ember.Controller.extend({needs:["requesttrack"]});Shoutzor.ArtistnameController=Ember.ArrayController.extend({itemController:"normalItem"});Shoutzor.ArtistnamenolinkController=Ember.ArrayController.extend({itemController:"normalItem"});Shoutzor.AlbumnameController=Ember.ArrayController.extend({itemController:"normalItem"});Shoutzor.NormalItemController=Ember.ObjectController.extend({needs:["application"]});
Shoutzor.AlbumContentController=Ember.ObjectController.extend({needs:["requesttrack"],tracks:function(){var a=this.get("model.id");return this.store.find("track",{artist:a})}.property("model")});
Shoutzor.HomeController=Ember.Controller.extend({needs:["application"],content:history,sortProperties:["time_played"],sortAscending:!0,history:Ember.computed.alias("controllers.application.history"),queue:Ember.computed.alias("controllers.application.queue"),nextSong:Ember.computed.alias("controllers.application.nextSong"),currentSong:Ember.computed.alias("controllers.application.currentSong"),previousSong:Ember.computed.alias("controllers.application.previousSong")});Shoutzor.ProfileController=Ember.Controller.extend({});
Shoutzor.QueueController=Ember.Controller.extend({sortProperties:["time_requested"],sortAscending:!0});
Shoutzor.RequesttrackController=Ember.Controller.extend({singleButton:[Ember.Object.create({title:"Close",clicked:"closeManual"})],bothButtons:[Ember.Object.create({title:"Request",clicked:"submitManual",type:"success"}),Ember.Object.create({title:"Cancel",clicked:"closeManual"})],closeManual:function(){return Bootstrap.ModalManager.close("requestTrackModal")},submitManual:function(){Bootstrap.ModalManager.close("requestTrackModal");Bootstrap.ModalManager.open("requestTrackModal","Request Track",
"Requesttrackloading",this.singleButton,this);$.getJSON(CONFIG.host+"/"+CONFIG.namespace+"/request/"+this.get("track.id"),function(a){var b=!0===a.result?"alert alert-success":"alert alert-danger";$(".modal-body").html("<div class='"+b+"'>"+a.message+"</p>")}).fail(function(){$(".modal-body").html("<p>The request for your track failed, if this error keeps happening please report it.</p>")});return!1},actions:{requestTrack:function(a){this.set("track",a);Bootstrap.ModalManager.open("requestTrackModal",
"Request Track","Requesttrack",this.bothButtons,this)}},model:function(){return this.get("track")}.property("track")});
Shoutzor.PlayersettingsController=Ember.Controller.extend({singleButton:[Ember.Object.create({title:"Close",clicked:"closeManual"})],closeManual:function(){return Bootstrap.ModalManager.close("playerSettingsModal")},submitManual:function(){Bootstrap.ModalManager.close("playerSettingsModal");$.getJSON(CONFIG.host+"/"+CONFIG.namespace+"/request/"+this.get("track.id"),function(a){var b=!0===a.result?"alert alert-success":"alert alert-danger";$(".modal-body").html("<div class='"+b+"'>"+a.message+"</p>")}).fail(function(){$(".modal-body").html("<p>The request for your track failed, if this error keeps happening please report it.</p>")});
return!1},actions:{getsettings:function(){Bootstrap.ModalManager.open("playerSettingsModal","Player Settings","playersettings",this.singleButton,this)}},model:function(){return this.get("track")}.property("track")});
Shoutzor.SearchController=Ember.Controller.extend({needs:["requesttrack"],search:"",query:!1,searching:!1,actions:{query:function(a){if(void 0==a||null==a)a="";var b=this;b.set("search",a);b.set("query",!0);b.set("searching",!0);this.store.find("search",{query:a}).then(function(){b.set("searching",!1)},function(){b.set("searching",!1)})}}});Shoutzor.TrackController=Ember.Controller.extend();Shoutzor.UploadController=Ember.Controller.extend({});
Shoutzor.UploadPageContentView=Ember.View.extend({didInsertElement:function(a){console.log("rendering upload page");$("#fileupload").fileupload({url:CONFIG.fileuploadapi,type:"POST",formAcceptCharset:"utf-8",singleFileUploads:!0,sequentialUploads:!0,autoUpload:!0,maxFileSize:31457280,acceptFileTypes:/(\.|\/)(mp3|ogg|flac)$/i,filesContainer:$("#fileupload table"),uploadTemplateId:"template-upload"})}});
Shoutzor.SettingsPageContentView=Ember.View.extend({intervalUpdate:null,didInsertElement:function(a){$("#volume").knobRot({classes:["volume"],dragVertical:!0,frameCount:49,frameWidth:149,frameHeight:149,detent:!0,detentThreshold:5,minimumValue:0,maximumValue:100,hideInput:!1});var b=0;$("#volume").bind("knobdrag",function(a){volume=$("#volume").knobRot("getvalue")});$("#volume").bind("knobmouseout",function(a){console.log("called");volume=$("#volume").knobRot("getvalue");b!=volume&&($.post(CONFIG.host+
"/api/",{network:"shoutzor",method:"changevolume",volume:volume},function(a){return void 0!=a.shoutzor.result?!0:!1},"json").error(function(){return!1}),b=volume)});var c=function(){console.log("updating system info");$.post(CONFIG.host+"/api/",{network:"shoutzor",method:"getsysteminfo"},function(a){void 0!=a.shoutzor.result&&(!1!==a.shoutzor.result.mainliquidsoap_status?($("#liquidsoapStatus #toggleMainService").removeClass().addClass("btn btn-danger").html("Stop Main"),$("#liquidsoapStatus #mainService").removeClass().addClass("alert alert-success").html("The Main LiquidSoap service is running, uptime: "+
a.shoutzor.result.mainliquidsoap_status)):($("#liquidsoapStatus #toggleMainService").removeClass().addClass("btn btn-success").html("Start Main"),$("#liquidsoapStatus #mainService").removeClass().addClass("alert alert-danger").html("The Main LiquidSoap service is not running")),!1!==a.shoutzor.result.shoutzorliquidsoap_status?($("#liquidsoapStatus #toggleShoutzorService").removeClass().addClass("btn btn-danger").html("Stop Shoutzor"),$("#liquidsoapStatus #shoutzorService").removeClass().addClass("alert alert-success").html("The Shoutzor LiquidSoap service is running, uptime: "+
a.shoutzor.result.shoutzorliquidsoap_status)):($("#liquidsoapStatus #toggleShoutzorService").removeClass().addClass("btn btn-success").html("Start Shoutzor"),$("#liquidsoapStatus #shoutzorService").removeClass().addClass("alert alert-danger").html("The Shoutzor LiquidSoap service is not running")))},"json").error(function(){})};this.set("intervalUpdate",setInterval(function(){c()},5E3));c();$("#liquidsoapStatus #toggleMainService").click(function(){if(!0==confirm("Are you sure?")){var a=$(this).hasClass("btn-success")?
"start":"stop";$.post(CONFIG.host+"/api/",{network:"shoutzor",method:"toggleliquidsoap",service:"main",operation:a},function(a){},"json").error(function(){})}});$("#liquidsoapStatus #toggleShoutzorService").click(function(){if(!0==confirm("Are you sure?")){var a=$(this).hasClass("btn-success")?"start":"stop";$.post(CONFIG.host+"/api/",{network:"shoutzor",method:"toggleliquidsoap",service:"shoutzor",operation:a},function(a){},"json").error(function(){})}});$("#liquidsoapStatus #nextTrack").click(function(){!0==
confirm("Are you sure?")&&$.post(CONFIG.host+"/api/",{network:"shoutzor",method:"toggleliquidsoap",service:"shoutzor",operation:"next"},function(a){},"json").error(function(){})});$("#liquidsoapStatus #cpForward").click(function(){!0==confirm("Are you sure?")&&$.post(CONFIG.host+"/api/",{network:"shoutzor",method:"correctplaylistforward"},function(a){},"json").error(function(){})});$("#liquidsoapStatus #cpBackward").click(function(){!0==confirm("Are you sure?")&&$.post(CONFIG.host+"/api/",{network:"shoutzor",
method:"correctplaylistbackward"},function(a){},"json").error(function(){})})},willDestroyElement:function(a){clearInterval(this.get("intervalUpdate"))}});
Shoutzor.ApplicationView=Ember.View.extend({didInsertElement:function(a){(function(){var a=$("#equalizerContainer").get(0),c=$("#audio").get(0);Pocket.init(a,c,"/static/themes/dashboard/js/equalizer/presets/void.js",{w:326,h:326,watchHash:!0});void 0!=$.cookie("visualizer")&&(Pocket.loadScript($.cookie("visualizer")),"/static/themes/dashboard/js/equalizer/presets/empty.js"==$.cookie("visualizer")&&$("#equalizerContainer").hide());$("body").on("click","#equalizerVisualisations li",function(){$.cookie("visualizer",
$(this).attr("data-script"),{expires:7,path:"/"});Pocket.loadScript($(this).attr("data-script"));$(this).hasClass("empty")?$("#equalizerContainer").hide():$("#equalizerContainer").show()})})();$("#bar").minibar({width:70,height:5,a:5,b:5});$("li.like, li.dislike").click(function(){$("li.like span, li.dislike span").removeClass("active");$(this).find("span").addClass("active");$(this).hasClass("like")?($("#likes").html("51%"),$("#dislikes").html("49%"),$("#bar").minibar({width:70,height:5,a:6,b:4})):
($("#likes").html("49%"),$("#dislikes").html("51%"),$("#bar").minibar({width:70,height:5,a:4,b:6}))});$("body").on("playmusic",function(){$("#player-controls li.progressbar .progress").addClass("progress-striped active");$("#player-controls li.play span").removeClass().addClass("pause-icon")}).on("stopmusic",function(){$("#player-controls li.play span").removeClass().addClass("play-icon");$("#player-controls li.progressbar .progress").removeClass("progress-striped active")});$("li.play").click(function(){$("li.play").find("span").hasClass("play-icon")?
(soundManager.unload("shoutzor"),soundManager.play("shoutzor")):soundManager.stop("shoutzor")});$(".slider").slider({min:100,max:0,step:1,orientation:"vertical",value:100,tooltip:"hide",handle:"round"}).on("slide",function(a){$(".slide").slider("setValue",a.value);soundManager.setVolume("shoutzor",a.value)});$("*[data-toggle=tooltip]").tooltip({trigger:"hover",animation:!1,placement:"right",delay:0})}});